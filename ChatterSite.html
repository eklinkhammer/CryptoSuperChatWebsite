<!DOCTYPE html>
<html lang="en">
    <head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Solana Transfer Form</title>
    </head>
    <body>
	<h1 style="font-size: 2em; font-weight: bold; text-align: center;">CryptoSuperChat STREAMER_ID</h1>
	<h1>Transfer SOL using Phantom Wallet</h1>
	<form id="transferForm">
	    <label for="name">Name:</label>
	    <input type="text" id="name" name="name" required><br><br>

	    <label for="amount">Amount (in SOL):</label>
	    <input type="number" id="amount" name="amount" step="0.00001" min="0.00001" value="0.00001" required><br><br>

	    <label for="message">Message:</label>
	    <input type="text" id="message" name="message"><br><br>

	    <button type="button" id="submitSolanaButton">Submit</button>
	</form>

	<script>
	    document.getElementById('submitSolanaButton').addEventListener('click', async () => {
		const getProvider = () => {
		    if ('phantom' in window) {
			const provider = window.phantom?.solana;

			if (provider?.isPhantom) {
			    return provider;
			}
		    }

		    window.open('https://phantom.app/', '_blank');
		};
		const name = document.getElementById('name').value;
		const amount = parseFloat(document.getElementById('amount').value);
		const message = document.getElementById('message').value;

		const provider = getProvider();
		console.log("Got solona provider");
		try {
		    // Connect to the Phantom wallet
		    const resp = await window.solana.connect();
		    const senderPublicKey = resp.publicKey;

		    // Specify the recipient address and amount
		    const recipientAddress = '3WZUQ2CTE1jsoANZCZd1786TGy6fcwk69c67ybqedtzH';
		    const lamports = amount * 1000000000; // Convert SOL to lamports

		    // Create the transaction
		    const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('testnet'));
		    const transaction = new solanaWeb3.Transaction().add(
			solanaWeb3.SystemProgram.transfer({
			    fromPubkey: senderPublicKey,
			    toPubkey: new solanaWeb3.PublicKey(recipientAddress),
			    lamports: lamports,
			})
		    );

		    // Sign the transaction
		    const { signature } = await window.solana.signAndSendTransaction(transaction);
		    alert(`Transaction sent! Signature: ${signature}`);
		} catch (error) {
		    console.error(error);
		    alert('Transaction failed. Check the console for more details.');
		}
	    });
	</script>

	<!-- Include Solana Web3.js library -->
	<script src="https://unpkg.com/@solana/web3.js@^1.41.0/dist/web3.min.js"></script>
    </body>
</html>

